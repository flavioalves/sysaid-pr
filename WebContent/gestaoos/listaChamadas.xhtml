<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="template.xhtml">
	
	
	<ui:define name="body">

		<h3>
			<h:outputText value="#{msg['menu.vinculo']}" />
		</h3>
		<h:outputText value="#{msg['menu.vinculo.texto']}" />
		<br />

		<h:form id="form">
		<div style="width: 95%">
		
        
				<p:dataTable id="listaOS" value="#{vincularTecnicoBean.modelList}" lazy="true"
					selection="#{vincularTecnicoBean.listaOS}" var="os" widgetVar="listaOS"
					rowKey="#{os.id}" paginator="true" rows="25">
				<f:facet name="header">
					<h:outputText value="#{msg['menu.vinculo.titulo']}" />
			        <p:commandButton id="toggler" type="button" value="Colunas" style="float:right" icon="ui-icon-calculator" />
			        <p:columnToggler datasource="listaOS" trigger="toggler" />
			    </f:facet>

			 <p:ajax event="rowSelectCheckbox" listener="#{vincularTecnicoBean.onRowSelect}" update=":form" />
             <p:ajax event="rowUnselectCheckbox" listener="#{vincularTecnicoBean.onRowUnselect}" update=":form" />
        
					<p:column selectionMode="multiple"
						style="width:10%;text-align:center"  />

					<p:column sortBy="#{os.id}">
						<f:facet name="header">
							<b><h:outputText value="N"
									style="float: left;" /></b>
						</f:facet>
		                #{os.id}
		            </p:column>
		            
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="End. do Atendimento"
									style="float: left;" /></b>
						</f:facet>
		                #{os.enderecoAtendimento}
		            </p:column>
		            
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="Solicitante"
									style="float: left;" /></b>
						</f:facet>
		                #{os.solicitante}
		            </p:column>
		            	
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="Status"
									style="float: left;" /></b>
						</f:facet>
					 #{os.status}
		            </p:column>	
 
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="Responsável"
									style="float: left;" /></b>
						</f:facet>
		                #{os.responsavel}
		            </p:column>	
		            
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="Data/Hora Solicitação"
									style="float: left;" /></b>
						</f:facet>
		                
		                <h:outputText >
		                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" type="both" />
		                </h:outputText>
		            </p:column>	
		            
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="Prioridade"
									style="float: left;" /></b>
						</f:facet>
		                #{os.prioridade}
		            </p:column>	
		            
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="Classificão OS"
									style="float: left;" /></b>
						</f:facet>
		                #{os.classificacao}
		            </p:column>	
		            
					<p:column >
						<f:facet name="header">
							<b><h:outputText value="Categoria"
									style="float: left;" /></b>
						</f:facet>
		                #{os.categoria}
		            </p:column>
		            <p:column >
						<f:facet name="header">
							<b><h:outputText value="Tel. Contato"
									style="float: left;" /></b>
						</f:facet>
		                #{os.contato}
		            </p:column>	
					
			<p:column filterBy="#{os.grupo}" headerText="Grupo Atendimento" footerText="exact" filterMatchMode="exact" >
            <f:facet name="filter">
                <p:selectOneMenu onchange="PF('listaOS').filter()"  value="#{vincularTecnicoBean.grupoId}">
                    <f:selectItem itemLabel="Grupos" itemValue="#{null}" noSelectionOption="true" />
                    <f:selectItems value="#{vincularTecnicoBean.listaGrupoSelect}" />
                    <p:ajax listener="#{vincularTecnicoBean.onGrupoChange}" update="listaOS" />
                </p:selectOneMenu>
            </f:facet>
            <h:outputText value=" #{os.grupo}" />
        </p:column> 		            
		            

				</p:dataTable>
				<br/>
			<p:commandButton value="Carregar" icon="ui-icon-disk" 
			disabled="#{vincularTecnicoBean.bloqueaBotao}"
			action="#{vincularTecnicoBean.resetGrupoTecnicos}" 
			update=":form:listaTecnicoPanel" 
			oncomplete="PF('listaTecnicoPopup').show()"
			style="float:right; width:100px" />
    </div>
    
    <p:dialog header="#{msg['menu.vinculo.popup.titulo']}" widgetVar="listaTecnicoPopup" modal="true" 
    showEffect="fade" hideEffect="fade" resizable="false" position="top" width="650" height="600">
        <p:outputPanel id="listaTecnicoPanel" >
        
	    
	    <p:dataTable value="#{vincularTecnicoBean.listaOS}" var="os">
	      <f:facet name="header">
          #{msg['menu.vinculo.chamados']}
        </f:facet>
		    <p:column headerText="Número OS" style="text-align:center">
		        <h:outputText value="#{os.id}" />
		    </p:column>
		 
		    <p:column headerText="Solicitante" style="text-align:center">
		        <h:outputText value="#{os.solicitante}" />
		    </p:column>
		 
		    <p:column headerText="Categoria" style="text-align:center">
		        <h:outputText value="#{os.categoria}" />
		    </p:column>
		</p:dataTable>
        
        
            <br/>
            
        <p:outputPanel id="listaTabelaTecnico">
        <p:outputLabel for="grupo" value="#{msg['menu.vinculo.popup.grupo']} :" style="float:left"/>
        <p:selectOneMenu  id="grupo" value="#{vincularTecnicoBean.grupoId}"  editable="false" style="margin-left:10px">
             <p:ajax listener="#{vincularTecnicoBean.onGrupoChange}" update="listaTecnicos" />
            <f:selectItem itemLabel="Selecione" itemValue="" />
            <f:selectItems value="#{vincularTecnicoBean.listaGrupoSelect}" />
        </p:selectOneMenu>
        
        <p:dataTable value="#{vincularTecnicoBean.listaUsuarios}" 
        paginator="true" rows="25"
        id="listaTecnicos" var="tec" type="ordered"  itemType="none" 
        selection="#{vincularTecnicoBean.tecnicoSelecionado}" 
					rowKey="#{tec.id}">
        <f:facet name="header">
          Técnicos
        </f:facet>
        <p:column width="120">
	     	<f:facet name="header" >
				<b><h:outputText value="Nome:" style="float: left;" /></b>
			</f:facet>        
	        #{tec.userNameCalculado}
	     </p:column>

						<p:column width="50">
							<f:facet name="header">
								<b><h:outputText value="Total OS hoje:" style="float: left;" /></b>
							</f:facet>
							<h:outputLink id="content" value="#">
								<h:outputText value="#{tec.osHoje.size()}" />
							</h:outputLink>

							<p:tooltip id="toolTipContent" for="content">
								<p:dataTable value="#{tec.osHoje}" var="resumoOS"
									style="width:200px">
									<f:facet name="header">
				          OS Hoje
				        </f:facet>

									<p:column>
										<f:facet name="header">
											<b><h:outputText value="N.:" style="float: left;" /></b>
										</f:facet>        
						        #{resumoOS.id}
						     </p:column>

									<p:column>
										<f:facet name="header">
											<b><h:outputText value="Solicitante:"
													style="float: left;" /></b>
										</f:facet>        
						         #{resumoOS.solicitante}
						     </p:column>

								</p:dataTable>
							</p:tooltip>

						</p:column>
						
					<p:column width="50">
							<f:facet name="header">
								<b><h:outputText value="OS em Aberto:" style="float: left;" /></b>
							</f:facet>
							<h:outputLink id="contentOS" value="#">
								<h:outputText value="#{tec.osTotalAberta.size()}" />
							</h:outputLink>

							<p:tooltip id="toolTipContentOS" for="contentOS">
								<p:dataTable value="#{tec.osTotalAberta}" var="resumoOS"
									style="width:300px">
									<f:facet name="header">
				          OS em Aberto
				        </f:facet>

									<p:column>
										<f:facet name="header">
											<b><h:outputText value="N.:" style="float: left;" /></b>
										</f:facet>        
						       #{resumoOS.id}
						     </p:column>

									<p:column>
										<f:facet name="header">
											<b><h:outputText value="Solicitante:"
													style="float: left;" /></b>
										</f:facet>        
						         #{resumoOS.solicitante}
						     </p:column>
									<p:column>
										<f:facet name="header">
											<b><h:outputText value="Dt Abertura:" style="float: left;" /></b>
										</f:facet>        
						        <h:outputText value="#{resumoOS.dataAbertura}">
									<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" type="both" />
								</h:outputText> 
						     </p:column>						     

								</p:dataTable>
							</p:tooltip>

						</p:column> 
						
		<p:column width="50" style="text-align: center">
             <p:commandButton value="ok" update=":form"  icon="ui-icon-check" title="Salvar"
             action="#{vincularTecnicoBean.salvarTecnico}"
             oncomplete="PF('listaTecnicoPopup').hide()">
                <f:setPropertyActionListener value="#{tec}" target="#{vincularTecnicoBean.tecnicoSelecionado}" />
            </p:commandButton>
        </p:column>				
	        
	    </p:dataTable>
	    </p:outputPanel>
        
        </p:outputPanel>
    </p:dialog>    
    </h:form>
			
			
	</ui:define>
</ui:composition>